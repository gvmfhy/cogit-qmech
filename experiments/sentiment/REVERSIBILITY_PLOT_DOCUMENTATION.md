# Reversibility Plot Documentation

## What This Visualization Shows

The reversibility test validates whether quantum operators can reverse each other's transformations - a key property that classical methods cannot achieve.

## Plot Structure

**Two histograms side-by-side:**

### Left Panel: "Reversibility: pos → neg → pos"
- **What's being tested**: Start with a positive sentiment quantum state, transform it to negative, then back to positive. How close do we get to the original?
- **Sample size**: 20 positive quantum states
- **Process**: original_pos → U_pos→neg → intermediate_neg → U_neg→pos → recovered_pos
- **Measurement**: Fidelity = |⟨original_pos|recovered_pos⟩|² (quantum state overlap)

### Right Panel: "Reversibility: neg → pos → neg"
- **What's being tested**: Start with a negative sentiment quantum state, transform it to positive, then back to negative. How close do we get to the original?
- **Sample size**: 20 negative quantum states
- **Process**: original_neg → U_neg→pos → intermediate_pos → U_pos→neg → recovered_neg
- **Measurement**: Fidelity = |⟨original_neg|recovered_neg⟩|² (quantum state overlap)

## Understanding the Axes

### X-axis: "Fidelity"
- **Range**: 0.0 to 1.0
- **Meaning**: How similar the recovered state is to the original state
  - 1.0 = Perfect reconstruction (states are identical)
  - 0.0 = Complete failure (states are orthogonal)
- **Formula**: |⟨ψ_original|ψ_recovered⟩|² (Born rule probability)

### Y-axis: "Count"
- **Meaning**: Number of test states (out of 20) that achieved that fidelity range
- **Each bar**: A histogram bin showing how many states fell into that fidelity range
- **Bar width**: Automatically determined by matplotlib (20 bins total)

### Red Dashed Line: "Mean: X.XXX"
- **Meaning**: Average fidelity across all 20 samples
- **Interpretation**:
  - ≥0.90: "EXCELLENT reversibility" (quantum advantage demonstrated)
  - 0.70-0.90: "GOOD reversibility"
  - 0.50-0.70: "MODERATE reversibility"
  - <0.50: "POOR reversibility"

## What High Fidelity Means

**If both panels show mean ≥0.90:**
- The operators are highly reversible (can undo each other's transformations)
- This is a quantum property - classical HDC cannot do this
- **However**: High reversibility ≠ effective steering
  - You can have operators that perfectly transform quantum states...
  - ...but produce zero behavioral effect when blended into text generation
  - This is the **null steering problem** we're debugging

## Example Interpretation

**Nov 5, 2025 Results:**
- Left panel: Mean = 0.985 (98.5% reconstruction)
- Right panel: Mean = 0.985 (98.5% reconstruction)
- **Conclusion**: Operators are EXCELLENT at reversing each other in quantum space
- **Problem**: Despite 98.5% reversibility, steering lift was only ~2pp (not significant)

## Data Source

**Generated by**: `experiments/sentiment/test_reversibility.py`
- **Input**: Trained operators from Phase 2 (`unitary_pos_to_neg_*.pt`, `unitary_neg_to_pos_*.pt`)
- **Input**: Quantum states from Phase 1 (`quantum_states_*_latest.json`)
- **Output**: Plot saved to `results/quantum_intervention/reversibility_plot_YYYYMMDD_HHMMSS.png`
- **Output**: Metrics saved to `results/quantum_intervention/reversibility_results_YYYYMMDD_HHMMSS.json`

## How to Run

```bash
# Run reversibility test for a specific model configuration
python experiments/sentiment/test_reversibility.py --preset qwen_local

# Requires:
# 1. Phase 1 data collection complete (quantum states exist)
# 2. Phase 2 operator training complete (operators exist)
```

## Technical Details

### Fidelity Calculation
From `test_reversibility.py:134`:
```python
fid = quantum_fidelity(original, recovered)
# where quantum_fidelity(ψ1, ψ2) = |⟨ψ1|ψ2⟩|²
```

### Why 20 Samples?
From `test_reversibility.py:121`:
```python
samples = min(20, len(self.positive_states))
```
Uses 20 states for statistical stability while keeping computation fast.

### Histogram Configuration
From `test_reversibility.py:259`:
```python
ax1.hist(results['fidelities'], bins=20, alpha=0.7, color='blue', edgecolor='black')
```
20 bins, semi-transparent bars, blue for positive, orange for negative.

## What's Missing (Why This Doc Exists)

The original plot has **no figure legend or caption**, making it unclear:
1. What the bars represent (histogram of 20 test samples)
2. What "fidelity" means (quantum state overlap)
3. What the red line is (mean across samples)
4. Why there are two panels (bidirectional reversibility test)
5. Where the data comes from (Phase 1 + Phase 2 outputs)
6. Why high reversibility doesn't guarantee steering works

This documentation fills those gaps.
